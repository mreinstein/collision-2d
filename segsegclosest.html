<!doctype html>
<html>
<head>
    <title>closest point tests</title>
    <meta name=theme-color content=#303F9F><meta name=viewport content="width=device-width,minimum-scale=1">
    <style>
        body {
          background-color: whitesmoke;
          padding: 10px;
        }

        canvas {
          background-color: black;
        }

    </style>
</head>
<body>

  <canvas width="600" height="600"></canvas>


<script type="module">

import closest   from './segseg-closest.js'
import * as vec2 from 'https://cdn.jsdelivr.net/npm/gl-matrix@3.3.0/esm/vec2.js'


const canvas = document.querySelector('canvas')
const ctx = canvas.getContext('2d')

const lines = [ ]

let startPoint


canvas.addEventListener('mousedown', function (ev) {
  if (lines.length === 2) {
    lines.length = 0
    return
  }

  if (startPoint) {
    const endPoint = [ ev.layerX, ev.layerY ]
    lines.push([ startPoint, endPoint ])
    startPoint = undefined
    if (lines.length === 2)
      console.log('closest distance:', closest(lines[0], lines[1]))

  } else {
    startPoint = [ ev.layerX, ev.layerY ]
  }
})


function update () {

  ctx.clearRect(0,0, 600, 600)

  ctx.strokeStyle = 'white'
  ctx.strokeWidth = 1 / devicePixelRatio

  ctx.beginPath()

  for (const line of lines) {
    ctx.moveTo(line[0][0], line[0][1])
    ctx.lineTo(line[1][0], line[1][1])
  }

  ctx.stroke()

  requestAnimationFrame(update)
}


requestAnimationFrame(update)

</script>
</body>
</html>
